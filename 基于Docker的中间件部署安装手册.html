<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#blog'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>基于Docker的中间件部署安装手册 - 微笑流浪</title>
  
    <meta name="keywords" content="middleware,deploy,install">
  
  
    <meta name="description" content="前提本文通篇以流水账的形式叙述，主要是用来记录基于docker环境离线安装中间件的部署过程(命令行极速版，没有操作详解)。
软件基于Ubuntu搭建，其他操作系统可能不适用">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  <!-- import link -->
  

  <link rel="shortcut icon" type="image/x-icon" sizes="16x16 32x32 48x48 64x64" href="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/img/favicon.ico">

  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
  
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7706779639350562" crossorigin="anonymous"></script>
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow floatable">

  <div class='wrapper'>
    <div class='nav-sub container--flex'>
      <a class="logo flat-box"></a>
      <ul class='switcher h-list'>
        <li><a class="s-comment flat-btn fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc flat-btn fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main container container--flex">
      
        
        <a class="logo flat-box" target="_self" href='/'>
          
          
          
          
            SILLY-BILLY'S <b><sup style='color:#3AA757'>blog</sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='h-list'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fas fa-home fa-fw fa-fw'></i>
                  
                  主页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  
                    <i class='fas fa-folder-open fa-fw'></i>
                  
                  分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  
                    <i class='fas fa-tags fa-fw'></i>
                  
                  标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  
                    <i class='fas fa-archive fa-fw'></i>
                  
                  归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/404.html
                  
                  
                  
                    id="404html"
                  >
                  
                    <i class='fas fa-link fa-fw'></i>
                  
                  友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  
                    <i class='fas fa-info-circle fa-fw'></i>
                  
                  关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      
        <div class="m_search">
          <form name="searchform" class="form u-search-form">
            <i class="icon fas fa-search fa-fw"></i>
            <input type="text" class="input u-search-input" placeholder="搜索" />
          </form>
        </div>
      

			<ul class='switcher h-list'>
				
					<li><a class="s-search flat-btn fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li><a class="s-menu flat-btn fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
<ul class="menu-phone navigation white-box">
  
  
    <li>
      <a class="flat-box" href=/
        
        
        
          id="home"
        >
        
          <i class='fas fa-rss fa-fw'></i>
        
        博客
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/categories/
        
        
        
          id="categories"
        >
        
          <i class='fas fa-folder-open fa-fw'></i>
        
        分类
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/tags/
        
        
        
          id="tags"
        >
        
          <i class='fas fa-tags fa-fw'></i>
        
        标签
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/archives/
        
        
        
          id="archives"
        >
        
          <i class='fas fa-archive fa-fw'></i>
        
        归档
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/404.html
        
        
        
          id="404html"
        >
        
          <i class='fas fa-link fa-fw'></i>
        
        友链
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/about/
        
        
        
          id="about"
        >
        
          <i class='fas fa-info-circle fa-fw'></i>
        
        关于
      </a>
    </li>
  
</ul>
<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box shadow floatable article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C.html">
        基于Docker的中间件部署安装手册
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/img/avatar.jpg">
    <p>silly-billy</p>
  </a>
</div>

          
        
          
            

          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-edit" aria-hidden="true"></i>
    <p>发布于：2023年1月3日</p>
  </a>
</div>

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>本文通篇以流水账的形式叙述，主要是用来记录基于<code>docker</code>环境离线安装中间件的部署过程(命令行极速版，没有操作详解)。</p>
<div class="note info">软件基于<code>Ubuntu</code>搭建，其他操作系统可能不适用</div>

<a id="more"></a>

<h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装<code>docker</code></h2><p>按照操作系统要求，选取合适的<code>docker</code>版本，下载地址：<a href="https://download.docker.com/linux/static/stable/x86_64/" target="_blank" rel="noopener">docker下载地址</a></p>
<ol>
<li><p>将下载好的软件包上传至服务器，并解压至<code>/usr/bin</code>目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf docker-20.10.22.tgz -C /usr/bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入<code>/etc/systemd/system</code>目录,并创建<code>docker.service</code>文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/systemd/system/docker.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>docker.service</code>服务文件(关注<code>ExecStart</code>启动命令)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line"><span class="meta">#</span><span class="bash"> the default is not to use systemd <span class="keyword">for</span> cgroups because the delegate issues still</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> exists and systemd currently does not support the cgroup feature <span class="built_in">set</span> required</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> containers run by docker</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker默认数据目录为/var/lib/docker,使用df -hl /var/lib/docker查看磁盘空间是否足够，否则使用--graph重新指定docker的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据目录，若内网搭建镜像仓库，可使用--insecure-registry=127.0.0.1(镜像仓库ip)指向自己的镜像仓库</span></span><br><span class="line">ExecStart=/usr/bin/dockerd --selinux-enabled=false --graph=/home/docker</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line"><span class="meta">#</span><span class="bash"> Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the kernel. We recommend using cgroups to <span class="keyword">do</span> container-local accounting.</span></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment TasksMax <span class="keyword">if</span> your systemd version supports it.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Only systemd 226 and above support this version.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">TasksMax=infinity</span></span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class="line">Delegate=yes</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">kill</span> only the docker process, not all processes <span class="keyword">in</span> the cgroup</span></span><br><span class="line">KillMode=process</span><br><span class="line"><span class="meta">#</span><span class="bash"> restart the docker process <span class="keyword">if</span> it exits prematurely</span></span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="4">
<li><p>给<code>docker.service</code>文件添加执行权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /etc/systemd/system/docker.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新加载配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动<code>docker</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看docker状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker.service</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="安装mysql集群（一主二从）"><a href="#安装mysql集群（一主二从）" class="headerlink" title="安装mysql集群（一主二从）"></a>安装<code>mysql</code>集群（一主二从）</h2><ol>
<li><p>下载<code>mysql</code>镜像上传至服务器，并解压镜像包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i mysql.tar</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建挂载目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建配置目录和数据目录</span></span><br><span class="line">mkdir -p /home/mysql/conf /home/mysql/data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建配置文件</span></span><br><span class="line">touch /home/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>my.cnf</code></p>
<ul>
<li>主节点配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置server_id,集群中每个服务的server_id不能存在相同</span></span><br><span class="line">server-id = 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置时区</span></span><br><span class="line">default-time-zone = '+08:00'</span><br><span class="line">pid-file = /var/run/mysqld/mysqld.pid</span><br><span class="line">socket = /var/run/mysqld/mysqld.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器数据目录</span></span><br><span class="line">datadir = /var/lib/mysql</span><br><span class="line">secure-file-priv= NULL</span><br><span class="line"><span class="meta">#</span><span class="bash"> Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> Custom config should go here</span></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">max_connections=1000</span><br><span class="line">wait_timeout=28800</span><br><span class="line">interactive_timeout=28800</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 开启binlog</span></span></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># binlog缓存</span></span></span><br><span class="line">binlog_cache_size=1M</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># binlog格式(mixed、statement、row,默认格式是statement)</span></span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#设置字符编码为utf8mb4</span></span></span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect='SET NAMES utf8mb4'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 忽略大小写</span></span><br><span class="line">lower_case_table_names=1</span><br><span class="line">[client]</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set = utf8mb4</span><br></pre></td></tr></table></figure>
<ul>
<li>从节点配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置server_id,注意要唯一</span></span><br><span class="line">server-id=2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 忽略大小写</span></span><br><span class="line">lower_case_table_names=1</span><br><span class="line">max_connections=1000</span><br><span class="line">wait_timeout=28800</span><br><span class="line">interactive_timeout=28800</span><br><span class="line">default-time_zone = '+8:00'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启binlog</span></span><br><span class="line">log-bin=mysql-slave-bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> relay_log配置中继日志</span></span><br><span class="line">relay_log=edu-mysql-relay-bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果需要同步函数或者存储过程</span></span><br><span class="line">log_bin_trust_function_creators=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> binlog缓存</span></span><br><span class="line">binlog_cache_size=1M</span><br><span class="line"><span class="meta">#</span><span class="bash"> binlog格式(mixed、statement、row,默认格式是statement)</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"><span class="meta">#</span><span class="bash">设置字符编码为utf8mb4</span></span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect='SET NAMES utf8mb4'</span><br><span class="line">slave_skip_errors=1062</span><br><span class="line">[client]</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set = utf8mb4</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行实例</p>
<ul>
<li><p>主节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -p 3306:3306 \</span><br><span class="line">--name mysql-icp-master \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /home/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=sillybilly@2022 \</span><br><span class="line">70325c69f1fe</span><br></pre></td></tr></table></figure>
</li>
<li><p>从节点1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -p 3306:3306 \</span><br><span class="line">--name  mysql-icp-slave1 \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /home/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=sillybilly@2022 \</span><br><span class="line">70325c69f1fe</span><br></pre></td></tr></table></figure>
</li>
<li><p>从节点2</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd -p 3306:3306 \</span><br><span class="line">--name  mysql-icp-slave2 \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /home/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=sillybilly@2022 \</span><br><span class="line">70325c69f1fe</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>主从同步配置</p>
<ul>
<li><p>进入master节点容器，并执行mysql命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入mysql命令列界面</span></span><br><span class="line">mysql -uroot -psillybilly@2022</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看主节点信息</span></span><br><span class="line">SHOW MASTER STATUS;</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/20230105/1.png" alt="result"></p>
</li>
<li><p>进入<code>mysql</code>从节点，编辑同步配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置连接的参数</span></span><br><span class="line">change master to master_host='10.10.33.102',master_user='root',master_password='sillybilly@2022',master_log_file='mysql-bin.000003',master_log_pos=62973466;</span><br></pre></td></tr></table></figure>

<p><code>master_host</code>:主节点ip</p>
<p><code>master_user</code>:主节点登录用户名</p>
<p><code>master_password</code>:主节点mysql登录密码</p>
<p><code>master_log_file</code>:主节点日志文件，修改为<code>master</code>节点执行<code>SHOW MASTER STATUS</code>结果后的<code>File</code>字段</p>
<p><code>master_log_pos</code>:二进制文件开始位置，修改为<code>master</code>节点执行<code>SHOW MASTER STATUS</code>结果后的<code>Position</code>字段</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 停止连接，如果一次成功无需使用该命令</span></span><br><span class="line">stop slave;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重置连接</span></span><br><span class="line">reset slave;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动同步</span></span><br><span class="line">start slave;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看从节点状态是否成功</span></span><br><span class="line">show slave status;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 观察两项都为Yes时代表成功。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Slave_IO_Running: Yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Slave_SQL_Running: Yes</span></span><br></pre></td></tr></table></figure>

<p>如果失败的话，需要执行<code>stop slave</code>并检查主节点的账号、密码，地址，<code>pos</code>等参数</p>
</li>
</ul>
</li>
</ol>
<h2 id="安装minio集群"><a href="#安装minio集群" class="headerlink" title="安装minio集群"></a>安装<code>minio</code>集群</h2><p>下载<code>minio docker</code>镜像包，并解压镜像，这里不过多赘述</p>
<h3 id="单机版"><a href="#单机版" class="headerlink" title="单机版"></a>单机版</h3><p>启动<code>docker</code>实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 9000:9000 \</span><br><span class="line">-p 19001:19001 \</span><br><span class="line">--name minio-icp \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /data/minio/data:/data \</span><br><span class="line">-e "MINIO_ROOT_USER=sillybilly" \</span><br><span class="line">-e "MINIO_ROOT_PASSWORD=sillybilly@2022" \</span><br><span class="line">minio/minio server /data \</span><br><span class="line">--console-address ":19001" \</span><br><span class="line">--address ":9000"</span><br></pre></td></tr></table></figure>

<p><code>MINIO_ROOT_USER</code>:用户名</p>
<p><code>MINIO_ROOT_PASSWORD</code>:密码</p>
<p><code>console-address</code>:web控制台端口，可不指定</p>
<p><code>address</code>:api访问端口</p>
<h3 id="集群版"><a href="#集群版" class="headerlink" title="集群版"></a>集群版</h3><ol>
<li><p>主机映射</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 57、58、59三台服务器添加主机映射</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在文件末尾添加以下信息 (实际需改成自己的ip地址，填内网ip,不能填公网ip)</span></span><br><span class="line">10.10.33.57 minio1</span><br><span class="line">10.10.33.58 minio2</span><br><span class="line">10.10.33.59 minio3</span><br></pre></td></tr></table></figure>
</li>
<li><p>每个节点指定两个数据目录，例如<code>/opt/data1</code>,<code>/opt/data2</code>,最好是两块单独的磁盘</p>
</li>
<li><p>启动<code>minio</code>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name minio-icp \</span><br><span class="line">--restart&#x3D;always \</span><br><span class="line">--net&#x3D;host \</span><br><span class="line">-e &quot;MINIO_ROOT_USER&#x3D;sillybilly&quot; \</span><br><span class="line">-e &quot;MINIO_ROOT_PASSWORD&#x3D;sillybilly@2022&quot; \</span><br><span class="line">-v &#x2F;opt&#x2F;data1:&#x2F;data1 \</span><br><span class="line">-v &#x2F;opt&#x2F;data2:&#x2F;data2 \</span><br><span class="line">minio&#x2F;minio server \</span><br><span class="line">--address &quot;:9000&quot; \</span><br><span class="line">--console-address &quot;:19001&quot; \</span><br><span class="line">http:&#x2F;&#x2F;minio&#123;1...3&#125;&#x2F;data&#123;1...2&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问<code>10.10.33.57:19001</code>验证</p>
</li>
</ol>
<h2 id="安装elasticsearch集群"><a href="#安装elasticsearch集群" class="headerlink" title="安装elasticsearch集群"></a>安装<code>elasticsearch</code>集群</h2><table>
<thead>
<tr>
<th>ip</th>
<th>hostname</th>
<th>default-role</th>
</tr>
</thead>
<tbody><tr>
<td>10.10.33.102</td>
<td>node1</td>
<td>master</td>
</tr>
<tr>
<td>10.10.33.57</td>
<td>node2</td>
<td>slave1</td>
</tr>
<tr>
<td>10.10.33.58</td>
<td>node3</td>
<td>slave2</td>
</tr>
</tbody></table>
<p><code>elasticsearch8.x</code>需要<code>jdk17</code>，因为我们大多数项目路使用<code>jdk8</code>，所以本次搭建使用<code>elasticsearch:7.17.8</code></p>
<ol>
<li><p>添加主机映射</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加主机映射关系至文件末尾</span></span><br><span class="line">10.10.33.102 node1</span><br><span class="line">10.10.33.57 node2</span><br><span class="line">10.10.33.58 node3</span><br></pre></td></tr></table></figure>
</li>
<li><p>调整系统打开文件句柄数以及用户创建进程数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 末尾添加</span></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 2048</span><br><span class="line">* hard nproc 4096</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">增大文件句柄数</span></span><br><span class="line">echo 'vm.max_map_count=262144' &gt;&gt;/etc/sysctl.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 立即生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动<code>elasticsearch</code>容器，拷贝<code>es</code>挂载目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 先简单起容器，方便从容器中把配置拷贝出来</span></span><br><span class="line">docker run -d --name elasticsearch \</span><br><span class="line">-p 9200:9200 \</span><br><span class="line">-p 9300:9300 \</span><br><span class="line">-e  "discovery.type=single-node" \</span><br><span class="line">-e ES_JAVA_OPTS="-Xms256m -Xmx256m" \</span><br><span class="line">elasticsearch:7.17.8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝挂载目录</span></span><br><span class="line">docker cp elasticsearch:/usr/share/elasticsearch/config /data1/elasticsearch</span><br><span class="line">docker cp elasticsearch:/usr/share/elasticsearch/logs /data1/elasticsearch</span><br><span class="line">docker cp elasticsearch:/usr/share/elasticsearch/data /data1/elasticsearch</span><br><span class="line">docker cp elasticsearch:/usr/share/elasticsearch/plugins /data1/elasticsearch</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>elasticsearch.yml</code>配置</p>
<ul>
<li><p>master</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置集群名称，集群内所有节点的名称必须一致。</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">icp-es-cluster</span></span><br><span class="line"><span class="comment"># 设置节点名称，集群内节点名称必须唯一。</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node1</span></span><br><span class="line"><span class="comment"># 表示该节点会不会作为主节点，true表示会；false表示不会</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 当前节点是否用于存储数据，是：true、否：false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 索引数据存放的位置</span></span><br><span class="line"><span class="comment">#path.data: /usr/share/elasticsearch/data</span></span><br><span class="line"><span class="comment"># 日志文件存放的位置</span></span><br><span class="line"><span class="comment">#path.logs: /usr/share/elasticsearch/logs</span></span><br><span class="line"><span class="comment"># 需求锁住物理内存，是：true、否：false</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line"><span class="comment"># 监听地址，用于访问该es</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># es对外提供的http端口，默认 9200</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">19200</span></span><br><span class="line"><span class="comment"># TCP的默认监听端口，默认 9300</span></span><br><span class="line"><span class="attr">transport.tcp.port:</span> <span class="number">19300</span></span><br><span class="line"><span class="comment"># 设置这个参数来保证集群中的节点可以知道其它N个有master资格的节点。默认为1，对于大的集群来说，可以设置大一点的值（2-4）</span></span><br><span class="line"><span class="attr">discovery.zen.minimum_master_nodes:</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># es7.x 之后新增的配置，写入候选主节点的设备地址，在开启服务后可以被选为主节点</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> <span class="string">["10.10.33.102:19300",</span> <span class="string">"10.10.33.57:19300"</span><span class="string">,"10.10.33.58:19300"]</span></span><br><span class="line"><span class="attr">discovery.zen.fd.ping_timeout:</span> <span class="string">1m</span></span><br><span class="line"><span class="attr">discovery.zen.fd.ping_retries:</span> <span class="number">5</span></span><br><span class="line"><span class="comment"># es7.x 之后新增的配置，初始化一个新的集群时需要此配置来选举master</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">["node1"]</span></span><br><span class="line"><span class="comment"># 是否支持跨域，是：true，在使用head插件时需要此配置</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># “*” 表示支持所有域名</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">ingest.geoip.downloader.enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>slave1</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置集群名称，集群内所有节点的名称必须一致。</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">icp-es-cluster</span></span><br><span class="line"><span class="comment"># 设置节点名称，集群内节点名称必须唯一。</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node2</span></span><br><span class="line"><span class="comment"># 表示该节点会不会作为主节点，true表示会；false表示不会</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 当前节点是否用于存储数据，是：true、否：false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 索引数据存放的位置</span></span><br><span class="line"><span class="comment">#path.data: /usr/share/elasticsearch/data</span></span><br><span class="line"><span class="comment"># 日志文件存放的位置</span></span><br><span class="line"><span class="comment">#path.logs: /usr/share/elasticsearch/logs</span></span><br><span class="line"><span class="comment"># 需求锁住物理内存，是：true、否：false</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line"><span class="comment"># 监听地址，用于访问该es</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># es对外提供的http端口，默认 9200</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">19200</span></span><br><span class="line"><span class="comment"># TCP的默认监听端口，默认 9300</span></span><br><span class="line"><span class="attr">transport.tcp.port:</span> <span class="number">19300</span></span><br><span class="line"><span class="comment"># 设置这个参数来保证集群中的节点可以知道其它N个有master资格的节点。默认为1，对于大的集群来说，可以设置大一点的值（2-4）</span></span><br><span class="line"><span class="attr">discovery.zen.minimum_master_nodes:</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># es7.x 之后新增的配置，写入候选主节点的设备地址，在开启服务后可以被选为主节点</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> <span class="string">["10.10.33.102:19300",</span> <span class="string">"10.10.33.57:19300"</span><span class="string">,"10.10.33.57:19300"]</span></span><br><span class="line"><span class="attr">discovery.zen.fd.ping_timeout:</span> <span class="string">1m</span></span><br><span class="line"><span class="attr">discovery.zen.fd.ping_retries:</span> <span class="number">5</span></span><br><span class="line"><span class="comment"># es7.x 之后新增的配置，初始化一个新的集群时需要此配置来选举master</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">["node1"]</span></span><br><span class="line"><span class="comment"># 是否支持跨域，是：true，在使用head插件时需要此配置</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># “*” 表示支持所有域名</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">ingest.geoip.downloader.enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>slave2</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置集群名称，集群内所有节点的名称必须一致。</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">icp-es-cluster</span></span><br><span class="line"><span class="comment"># 设置节点名称，集群内节点名称必须唯一。</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node3</span></span><br><span class="line"><span class="comment"># 表示该节点会不会作为主节点，true表示会；false表示不会</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 当前节点是否用于存储数据，是：true、否：false</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 索引数据存放的位置</span></span><br><span class="line"><span class="comment">#path.data: /usr/share/elasticsearch/data</span></span><br><span class="line"><span class="comment"># 日志文件存放的位置</span></span><br><span class="line"><span class="comment">#path.logs: /usr/share/elasticsearch/logs</span></span><br><span class="line"><span class="comment"># 需求锁住物理内存，是：true、否：false</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line"><span class="comment"># 监听地址，用于访问该es</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># es对外提供的http端口，默认 9200</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">19200</span></span><br><span class="line"><span class="comment"># TCP的默认监听端口，默认 9300</span></span><br><span class="line"><span class="attr">transport.tcp.port:</span> <span class="number">19300</span></span><br><span class="line"><span class="comment"># 设置这个参数来保证集群中的节点可以知道其它N个有master资格的节点。默认为1，对于大的集群来说，可以设置大一点的值（2-4）</span></span><br><span class="line"><span class="attr">discovery.zen.minimum_master_nodes:</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># es7.x 之后新增的配置，写入候选主节点的设备地址，在开启服务后可以被选为主节点</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> <span class="string">["10.10.33.102:19300",</span> <span class="string">"10.10.33.57:19300"</span><span class="string">,"10.10.33.58:19300"]</span></span><br><span class="line"><span class="attr">discovery.zen.fd.ping_timeout:</span> <span class="string">1m</span></span><br><span class="line"><span class="attr">discovery.zen.fd.ping_retries:</span> <span class="number">5</span></span><br><span class="line"><span class="comment"># es7.x 之后新增的配置，初始化一个新的集群时需要此配置来选举master</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">["node1"]</span></span><br><span class="line"><span class="comment"># 是否支持跨域，是：true，在使用head插件时需要此配置</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># “*” 表示支持所有域名</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">ingest.geoip.downloader.enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>初始化容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name=elasticsearch-icp \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --network=host \</span><br><span class="line">  -v /data1/elasticsearch/config:/usr/share/elasticsearch/config \</span><br><span class="line">  -v /data1/elasticsearch/logs:/usr/share/elasticsearch/logs \</span><br><span class="line">  -v /data1/elasticsearch/data:/usr/share/elasticsearch/data \</span><br><span class="line">  -v /data1/elasticsearch/plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">  elasticsearch:7.17.8</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 浏览器输入地址 查看3个节点是否都加入集群</span></span><br><span class="line">http://10.10.33.102:19200/_cat/nodes</span><br></pre></td></tr></table></figure>
</li>
<li><p>QA</p>
<p>如果出现新启动的节点无法加入集群，报错例如: <code>&quot;Caused by: org.elasticsearch.cluster.coordination.CoordinationStateRejectedException: This node previously joined a cluster with UUID [NR0YxxfATD2Y1q4PnhXfoA] and is now trying to join a different cluster with UUID [3d1d4hnwR2e5kU9yYH2K5w]. This is forbidden and usually indicates an incorrect discovery or cluster bootstrapping configuration. Note that the cluster UUID persists across restarts and can only be changed by deleting the contents of the node&#39;s data paths [] which will also remove any data held by this node.&quot;</code></p>
</li>
</ol>
<p>​        可以删除<code>/data1/elasticsearch/data</code>中的数据，再次重启容器</p>
<h3 id="安装kibana-单机"><a href="#安装kibana-单机" class="headerlink" title="安装kibana(单机)"></a>安装<code>kibana</code>(单机)</h3><ol>
<li><p><code>kibana.yml</code>配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Kibana的映射端口</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">15601</span></span><br><span class="line"><span class="comment">#网关地址</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">"0.0.0.0"</span></span><br><span class="line"><span class="comment">#Kibana实例对外展示的名称</span></span><br><span class="line"><span class="attr">server.name:</span> <span class="string">"kibana"</span></span><br><span class="line"><span class="comment">#Elasticsearch的集群地址，也就是说所有的集群IP</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> <span class="string">["http://10.10.33.102:19200","http://10.10.33.57:19200","http://10.10.33.58:19200"]</span></span><br><span class="line"><span class="comment">#设置页面语言，中文使用zh-CN，英文使用en</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">"zh-CN"</span></span><br><span class="line"><span class="attr">xpack.monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># es用户名、密码</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">""</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">""</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>容器启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd \</span><br><span class="line">--network=host \</span><br><span class="line">-v /data1/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml  \</span><br><span class="line">--name kibana-icp \</span><br><span class="line">kibana:7.17.8</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="安装only-office-单机"><a href="#安装only-office-单机" class="headerlink" title="安装only-office(单机)"></a>安装<code>only-office</code>(单机)</h2><p>下载<code>only-office</code>镜像包，这里以<code>onlyoffice/documentserver:7.1</code>为例</p>
<ol>
<li><p>创建挂载目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 文档日志</span></span><br><span class="line">mkdir -p /home/onlyoffice/documentserver/logs</span><br><span class="line"><span class="meta">#</span><span class="bash"> 证书</span></span><br><span class="line">mkdir -p /home/onlyoffice/documentserver/data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件缓存</span></span><br><span class="line">mkdir -p /home/onlyoffice/documentserver/lib</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库</span></span><br><span class="line">mkdir -p /home/onlyoffice/documentserver/db</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t -d \</span><br><span class="line">--name office-icp \</span><br><span class="line">-p 7001:80 \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /home/onlyoffice/documentserver/logs:/var/log/onlyoffice \</span><br><span class="line">-v /home/onlyoffice/documentserver/data:/var/www/onlyoffice/Data \</span><br><span class="line">-v /home/onlyoffice/documentserver/lib:/var/lib/onlyoffice \</span><br><span class="line">-v /home/onlyoffice/documentserver/db:/var/lib/postgresql \</span><br><span class="line">onlyoffice/documentserver:7.1</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="未完待补充"><a href="#未完待补充" class="headerlink" title="未完待补充"></a>未完待补充</h2><p>…</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="docker命令"><a href="#docker命令" class="headerlink" title="docker命令"></a>docker命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取Docker中运行的组件的内网IP</span></span><br><span class="line">docker inspect --format='&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;' 【容器实例名称】</span><br></pre></td></tr></table></figure>

<h3 id="磁盘挂载"><a href="#磁盘挂载" class="headerlink" title="磁盘挂载"></a>磁盘挂载</h3><h4 id="新建分区"><a href="#新建分区" class="headerlink" title="新建分区"></a>新建分区</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出可用磁盘</span></span><br><span class="line">fdisk -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个新的磁盘分区 使用命令：<span class="string">"fdisk 磁盘名称"</span> （仅限2T磁盘的分区）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 按提示依次操作</span></span><br><span class="line">fdisk /dev/sdb</span><br></pre></td></tr></table></figure>

<h4 id="格式化硬盘"><a href="#格式化硬盘" class="headerlink" title="格式化硬盘"></a>格式化硬盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/sdb1</span><br></pre></td></tr></table></figure>

<h4 id="查询硬盘的UUID"><a href="#查询硬盘的UUID" class="headerlink" title="查询硬盘的UUID"></a>查询硬盘的<code>UUID</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo blkid</span><br></pre></td></tr></table></figure>

<h4 id="UUID写入配置"><a href="#UUID写入配置" class="headerlink" title="UUID写入配置"></a><code>UUID</code>写入配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件末尾添加磁盘信息 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> UUID为上一步查询的结果 /data为挂载目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ext4：文件系统类型 defaults:挂载参数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第五个字段为dump 参数 用检查一个文件系统是否应该进行 dump 备份。不需要就设置为 0，如果需要每天备份，设置为 1，不定期备份，设置为 2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第六个字段为开机检查分区的次序。对于根分区，这个值为 1，表示优先。其它文件系统可以设置为 2，表示次优，如果为 0 或没有设置，开机跳过此文件系统的检查</span></span><br><span class="line">UUID=d6644d06-0532-49d7-b7d4-5875b555a29c /data ext4  defaults 0 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出编辑 重启</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>


          
            <br>
            
  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=https://sillybilly-share.top/%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C.html>https://sillybilly-share.top/%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C.html</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class='content article-entry'>
    
  </div>
</section>

  


          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2023-01-11T09:58:56+08:00">
  <a class='notlink'>
    <i class="fas fa-save" aria-hidden="true"></i>
    <p>更新于：2023年1月11日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/middleware/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i><p>middleware</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/deploy/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i><p>deploy</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/install/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i><p>install</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://sillybilly-share.top/%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C.html&title=基于Docker的中间件部署安装手册 - 微笑流浪&summary=前提本文通篇以流水账的形式叙述，主要是用来记录基于docker环境离线安装中间件的部署过程(命令行极速版，没有操作详解)。
软件基于Ubuntu搭建，其他操作系统可能不适用"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://sillybilly-share.top/%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C.html&title=基于Docker的中间件部署安装手册 - 微笑流浪&summary=前提本文通篇以流水账的形式叙述，主要是用来记录基于docker环境离线安装中间件的部署过程(命令行极速版，没有操作详解)。
软件基于Ubuntu搭建，其他操作系统可能不适用"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://sillybilly-share.top/%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C.html&title=基于Docker的中间件部署安装手册 - 微笑流浪&summary=前提本文通篇以流水账的形式叙述，主要是用来记录基于docker环境离线安装中间件的部署过程(命令行极速版，没有操作详解)。
软件基于Ubuntu搭建，其他操作系统可能不适用"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
            
              <a class='next' href='/%E8%87%AA%E5%AE%9A%E4%B9%89springcloud%20loadbalancer%E8%A7%84%E5%88%99%20.html'>
                <p class='title'>自定义spring cloud loadbalancer负载路由规则<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>前提在微服务的架构中，虽然每个服务都是独立开发，但是如果一个服务由多个人协同开发，就会出现请求乱窜的问题。即服务A由甲乙两个人共同开发，nacos上会生成A1、A2两个服务实例，甲本地发起一个请...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments shadow floatable">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
        <section id="comments">
          <div id="lv-container" data-id="city" data-uid="MTAyMC80OTQ2OS8yNTk2MQ==">
            <noscript><div><i class='fas fa-exclamation-triangle'>&nbsp;无法加载Livere评论系统，请确保您的网络能够正常访问。</div></noscript>
          </div>
        </section>
      
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '基于Docker的中间件部署安装手册',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow floatable desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前提"><span class="toc-text">前提</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装docker"><span class="toc-text">安装docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装mysql集群（一主二从）"><span class="toc-text">安装mysql集群（一主二从）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装minio集群"><span class="toc-text">安装minio集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单机版"><span class="toc-text">单机版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集群版"><span class="toc-text">集群版</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装elasticsearch集群"><span class="toc-text">安装elasticsearch集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装kibana-单机"><span class="toc-text">安装kibana(单机)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装only-office-单机"><span class="toc-text">安装only-office(单机)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#未完待补充"><span class="toc-text">未完待补充</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker命令"><span class="toc-text">docker命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#磁盘挂载"><span class="toc-text">磁盘挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#新建分区"><span class="toc-text">新建分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#格式化硬盘"><span class="toc-text">格式化硬盘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询硬盘的UUID"><span class="toc-text">查询硬盘的UUID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UUID写入配置"><span class="toc-text">UUID写入配置</span></a></li></ol></li></ol></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix white">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='4926244994'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:1579700874@qq.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/silly-billy"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        
          <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
        
      
    
      
        
          <div><p>本站使用 <a href="https://volantis.js.org/" target="_blank" rel="noopener">Volantis</a> 作为主题 ， 总访问量为 <span id="busuanzi_value_site_uv"></span> 次</p>
</div>
        
      
    
      
        <div class='copyright'>
        <p>[Copyright © 2019-2020 silly-billy]</p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/img/backgroud.jpg", "https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/img/backgroud-1.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/APlayer.min.js" async></script>

  
    
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/Meting.min.js" async></script>

  





  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];
      if (typeof LivereTower === 'function') { return; }
      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;
      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>






  
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/comment_typing.js"></script>



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/clipboard.min.js"></script>
<script>
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copyed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-clipboard-check');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPYED';
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-exclamation-triangle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/silly-billy/eurekademo@blog_info/static/common/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
